# Architecture & Build Decisions

## 1. Multi-stage Docker Build
برای کاهش حجم Image نهایی و افزایش امنیت، فرآیند build و runtime جدا شد.
- Stage اول: Maven + JDK
- Stage دوم: JRE سبک (Alpine)

## 2. عدم Hardcode اطلاعات حساس
هیچ credential یا config حساسی داخل Dockerfile یا سورس کد قرار نگرفته است.
تنظیمات از طریق Environment Variable تزریق می‌شوند که با 12-Factor App سازگار است.

## 3. اجرای اپلیکیشن با Non-root User
به‌منظور کاهش Blast Radius در صورت compromise شدن کانتینر، اپلیکیشن با کاربر non-root اجرا می‌شود.

## 4. Healthcheck
برای سازگاری با Kubernetes / Docker Swarm، Healthcheck بر اساس
`/actuator/health` پیاده‌سازی شد.
این موضوع امکان Self-healing و Auto-restart را فراهم می‌کند.

## 5. انتخاب JRE به‌جای JDK در Runtime
JRE سطح attack surface و حجم image را کاهش می‌دهد و برای محیط production مناسب‌تر است.
======================================================================================================================================================================================================================================

## Telegram Bot Webhook Strategy

در این پروژه به‌منظور کاهش پیچیدگی شبکه و وابستگی به SSL،
از Long Polling به‌جای Webhook استفاده شده است.

خطای "Error removing old webhook" معمولاً ناشی از:
- Token نامعتبر
- مشکل Network در Container
- استفاده همزمان Polling و Webhook

استفاده از Polling در محیط Containerized پایدارتر و ساده‌تر است.


======================================================================================================================================================================================================================================
## Docker Compose Orchestration

برای شبیه‌سازی محیط production-lite از Docker Compose
به‌همراه network اختصاصی استفاده شد.

## Database Persistence
دیتابیس MySQL با volume مستقل اجرا می‌شود
تا داده‌ها در restart از بین نروند.

## Observability Strategy
- Spring Boot Actuator برای health و metrics
- Micrometer + Prometheus برای جمع‌آوری متریک‌ها
- Grafana برای visualization

این ساختار به‌راحتی به Kubernetes قابل مهاجرت است.

## Resource Management
برای هر سرویس محدودیت CPU و Memory تعریف شده
تا رفتار سیستم تحت فشار قابل پیش‌بینی باشد.

======================================================================================================================================================================================================================================

## Sanction Bypass Script Design

### انتخاب Bash
Bash به‌دلیل دسترسی گسترده در سرورهای لینوکسی و سادگی تعامل با OS انتخاب شد.

### تمرکز بر DNS به‌جای Proxy
DNS-based bypass:
- کم‌ریسک‌تر
- ساده‌تر
- بدون نیاز به تغییر سراسری proxy سیستم

### Dry-Run Mode
برای جلوگیری از تغییر ناخواسته در سیستم‌های production،
حالت شبیه‌سازی (dry-run) اضافه شد.

### Rollback Explicit
به‌جای rollback خودکار، دستور بازگشت شفاف نمایش داده می‌شود
تا کاربر کنترل کامل داشته باشد.

### Extensibility
تعریف سرویس‌ها به‌صورت config محور انجام شد
تا افزودن سرویس جدید نیاز به تغییر حداقلی در logic داشته باشد.
======================================================================================================================================================================================================================================
Threat Thinking (Nice to Have)
تهدید	ریسک	کنترل
اعمال اشتباه DNS	قطع ارتباط	backup + rollback
اجرای بدون آگاهی	misconfig	منوی تعاملی + توضیح
privilege abuse	system damage	بررسی root
تغییر ناخواسته prod	outage	dry-run
======================================================================================================================================================================================================================================
